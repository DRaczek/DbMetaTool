SET SQL DIALECT 3;
/******************************************************************************/
/*                                   Domeny                                   */
/******************************************************************************/

CREATE DOMAIN D_PRIMARY_KEY AS BIGINT NOT NULL;
CREATE DOMAIN D_SHORT_TEXT AS VARCHAR(50) CHARACTER SET UTF8 DEFAULT 'Brak danych';
CREATE DOMAIN D_LONG_TEXT AS BLOB SUB_TYPE TEXT CHARACTER SET UTF8;
CREATE DOMAIN D_AMOUNT AS NUMERIC(15, 4) DEFAULT 0.00;
CREATE DOMAIN D_FLAG AS BOOLEAN DEFAULT FALSE NOT NULL;
CREATE DOMAIN D_EVENT_TIME AS TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
COMMIT;

/******************************************************************************/
/*                                    Tabele                                  */
/******************************************************************************/

CREATE TABLE INVENTORY (
    ItemID      D_PRIMARY_KEY,
    ItemName    D_SHORT_TEXT,
    Description D_LONG_TEXT,
    Price       D_AMOUNT,
    AddedOn     D_EVENT_TIME,
    IsAvailable D_FLAG
);

CREATE TABLE DATA_TYPES_TEST (
    ID              INTEGER NOT NULL,
    TypeSmallInt    SMALLINT,
    TypeInteger     INTEGER,
    TypeBigInt      BIGINT,
    TypeFloat       FLOAT,
    TypeDouble      DOUBLE PRECISION,
    TypeNumeric     NUMERIC(18, 2),
    TypeDate        DATE,
    TypeTime        TIME,
    TypeTimestamp   TIMESTAMP,
    TypeChar        CHAR(10) CHARACTER SET UTF8,
    TypeVarchar     VARCHAR(200) CHARACTER SET UTF8,
    TypeBlobText    BLOB SUB_TYPE TEXT CHARACTER SET UTF8,
    TypeBlobBinary  BLOB SUB_TYPE BINARY,
    TypeBoolean     BOOLEAN
);
COMMIT;


/******************************************************************************/
/*                                  Procedury                                 */
/******************************************************************************/

SET TERM ^ ;

CREATE PROCEDURE PROCESS_ITEM (
    P_ITEM_ID D_PRIMARY_KEY,
    P_NEW_PRICE D_AMOUNT,
    P_COMMENT D_LONG_TEXT)
AS
BEGIN
  /* Ta procedura w rzeczywistości nic nie robi z danymi, */
  /* służy tylko do przetestowania eksportu jej definicji */
  /* i parametrów o różnych typach.                      */
  UPDATE INVENTORY SET Price = :P_NEW_PRICE WHERE ItemID = :P_ITEM_ID;
END^

CREATE PROCEDURE GET_ITEM_DETAILS (
    P_ITEM_ID D_PRIMARY_KEY)
RETURNS (
    R_ITEM_NAME D_SHORT_TEXT,
    R_IS_AVAILABLE D_FLAG,
    R_FULL_DESCRIPTION VARCHAR(1000) CHARACTER SET UTF8)
AS
DECLARE VARIABLE V_DESC_PART D_LONG_TEXT;
BEGIN
    SELECT ItemName, IsAvailable, Description
    FROM INVENTORY
    WHERE ItemID = :P_ITEM_ID
    INTO :R_ITEM_NAME, :R_IS_AVAILABLE, :V_DESC_PART;

    IF (V_DESC_PART IS NOT NULL) THEN
        R_FULL_DESCRIPTION = 'Opis produktu: ' || V_DESC_PART;
    ELSE
        R_FULL_DESCRIPTION = 'Brak dodatkowego opisu.';

    SUSPEND;
END^

SET TERM ; ^
COMMIT;


/******************************************************************************/
/*                             Dane Demonstracyjne                            */
/******************************************************************************/

INSERT INTO INVENTORY (ItemID, ItemName, Description, Price, AddedOn, IsAvailable)
VALUES (1, 'Gęśle dębowe', 'Instrument muzyczny wykonany ręcznie z drewna dębowego. Piękne, głębokie brzmienie.', 950.55, '2023-01-15 10:30:00', TRUE);

INSERT INTO INVENTORY (ItemID, ItemName, Description, Price, AddedOn, IsAvailable)
VALUES (2, 'Żelazny miecz', 'Replika broni z epoki średniowiecza. Nie naostrzony.', 320.00, '2023-03-20 12:00:00', TRUE);

INSERT INTO INVENTORY (ItemID, ItemName, Price, IsAvailable)
VALUES (3, 'Stary manuskrypt', 1200.00, FALSE); /* Description i AddedOn będą NULL/DEFAULT */

INSERT INTO INVENTORY (ItemID, ItemName, IsAvailable)
VALUES (4, 'Magiczna różdżka', TRUE); /* Price będzie DEFAULT (0.00), reszta NULL/DEFAULT */

INSERT INTO DATA_TYPES_TEST (ID, TypeSmallInt, TypeInteger, TypeBigInt, TypeFloat, TypeDouble, TypeNumeric, TypeDate, TypeTime, TypeTimestamp, TypeChar, TypeVarchar, TypeBlobText, TypeBoolean)
VALUES (
    1, 
    123, 
    123456, 
    9876543210, 
    123.45, 
    1.23456789e10, 
    999.99,
    '2024-01-01', 
    '14:30:00', 
    '2024-01-01 14:30:15.123', 
    'cześć', 
    'To jest dłuższy tekst z polskimi znakami: żółć, gęś, jaźń.', 
    'To jest zawartość pola BLOB, która może być bardzo długa i zawierać różne znaki specjalne, w tym ą, ę, ś, ć.', 
    TRUE
);

INSERT INTO DATA_TYPES_TEST (ID) VALUES (2); /* Wszystkie pozostałe kolumny będą NULL */

COMMIT;